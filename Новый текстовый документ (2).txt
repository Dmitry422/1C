// ++ Яковлев 30.03.2021 Проверка нет ли среди исполнителей в заказ-наряде уволенных сотрудников (по данным из регистра "Данные Для Подбора Сотрудников") 
СтрокаУволенных=""; 														// Строка ФИО
ДатаДок=ТекущийОбъект.Дата; 												// Дата проверяемого документа
Компания=ТекущийОбъект.Организация;											// Организация
НадоПредупредить=false; 													// Флаг необходимости вывести предупреждение
МассивСтрокИсполнители = ТекущийОбъект.Исполнители;
Для Каждого Стр из МассивСтрокИсполнители Цикл                                  
	Если СотрудникУволен (ДатаДок,Стр.Исполнитель,Компания) Тогда 				// Самописная Функция проверки был ли сотрудник уволен из указанной организации на указанную дату
		НадоПредупредить=true;
		СтрокаУволенных = СтрокаУволенных + " " + Стр.Исполнитель;
	КонецЕсли;
КонецЦикла;

Если НадоПредупредить Тогда ОбщегоНазначения.СообщитьПользователю ("Внимание! Следущие сотрудники числятся уволенными на дату документа: " + СтрокаУволенных); 
КонецЕсли;
// -- Яковлев 


// ++ Яковлев Функция СотрудникУволен. Проверка уволен ли сотрудник по данным из регистра Данные Для Подбора Сотрудников 
&НаСервере
Function СотрудникУволен (Дата, ФизическоеЛицо, Организация)
	Запрос =Новый Запрос;
	Запрос.УстановитьПараметр("Начало",Дата);
	Запрос.УстановитьПараметр("ФизическоеЛицо",ФизическоеЛицо);
	Запрос.УстановитьПараметр("Организация",Организация);
	Запрос.Текст="ВЫБРАТЬ ПЕРВЫЕ 1
           |	ДанныеДляПодбораСотрудников.Начало КАК Начало,
           |	ДанныеДляПодбораСотрудников.ВидСобытия КАК ВидСобытия,
           |	ДанныеДляПодбораСотрудников.ФизическоеЛицо КАК ФизическоеЛицо,
           |	ДанныеДляПодбораСотрудников.Организация КАК Организация
           |ИЗ
           |	РегистрСведений.ДанныеДляПодбораСотрудников КАК ДанныеДляПодбораСотрудников
           |ГДЕ
           |	ДанныеДляПодбораСотрудников.ФизическоеЛицо = &ФизическоеЛицо
           |	И ДанныеДляПодбораСотрудников.Организация = &Организация
           |	И ДанныеДляПодбораСотрудников.Начало <= &Начало
           |
           |УПОРЯДОЧИТЬ ПО
           |	Начало УБЫВ,
           |	ВидСобытия";
	РезультатЗапроса=Запрос.Выполнить();
	Выборка=РезультатЗапроса.Выбрать();
	IF Выборка.Следующий() и (Выборка.ВидСобытия=Перечисления.ВидыКадровыхСобытий.Увольнение) then 
		Возврат True;//and (Selection.ВидСобытия.Наименование="Увольнение") then Возврат True;  // Если запрос вернул не пустой ответ и в ответе Значение "Уволен", то Возвращаем положительный ответ
	Else Возврат False; 								// иначе возвращаем Отрицательный
EndIf;
EndFunction
// -- Яковлев
