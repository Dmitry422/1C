ВЫБРАТЬ
	        |	ВЫБОР
	        |		КОГДА &Аналоги
	        |			ТОГДА Арт_АналогиНоменклатуры.НоменклатураАналог
	        |		ИНАЧЕ &Номенклатура
	        |	КОНЕЦ КАК Номенклатура
	        |ПОМЕСТИТЬ ТЧАналоги
	        |ИЗ
	        |	РегистрСведений.Арт_АналогиНоменклатуры КАК Арт_АналогиНоменклатуры
	        |ГДЕ
	        |	Арт_АналогиНоменклатуры.Номенклатура = &Номенклатура
	        |
	        |ОБЪЕДИНИТЬ ВСЕ
	        |
	        |ВЫБРАТЬ
	        |	ВЫБОР
	        |		КОГДА НЕ &Аналоги
	        |			ТОГДА &Номенклатура
	        |	КОНЕЦ
	        |;
	        |
	        |////////////////////////////////////////////////////////////////////////////////
	        |ВЫБРАТЬ
	        |	ВложенныйЗапрос.Склад КАК Склад,
	        |	СУММА(ВложенныйЗапрос.СвободныйОстаток) КАК Остаток,
	        |	СУММА(ВложенныйЗапрос.ОстатокВРезерве) КАК Резерв,
	        |	СУММА(ВложенныйЗапрос.Свободный) КАК Свободный,
	        |	СУММА(ВложенныйЗапрос.КОформлениюОстаток) КАК КОформлению,
	        |	ВложенныйЗапрос.Назначение КАК Назначение,
	        |	ВложенныйЗапрос.Номенклатура КАК Номенклатура
	        |ИЗ
	        |	(ВЫБРАТЬ
	        |		ТоварыНаСкладахОстатки.Склад КАК Склад,
	        |		СУММА(ЕСТЬNULL(ТоварыНаСкладахОстатки.ВНаличииОстаток, 0) - ЕСТЬNULL(ТоварыКОтгрузкеОстатки.КОтгрузкеОстаток, 0) - ЕСТЬNULL(ТоварыКОтгрузкеОстатки.ВРезервеОстаток, 0)) КАК СвободныйОстаток,
	        |		СУММА(-ЕСТЬNULL(ТоварыКОтгрузкеОстатки.ВРезервеОстаток, 0)) КАК ОстатокВРезерве,
	        |		СУММА(0) КАК Свободный,
	        |		ТоварыНаСкладахОстатки.Назначение КАК Назначение,
	        |		1 КАК Поле1,
	        |		СУММА(ТоварыКОтгрузкеОстатки.КОформлениюОстаток) КАК КОформлениюОстаток,
	        |		ТоварыНаСкладахОстатки.Номенклатура КАК Номенклатура
	        |	ИЗ
	        |		РегистрНакопления.ТоварыНаСкладах.Остатки(
	        |				,
	        |				Номенклатура В
	        |						(ВЫБРАТЬ
	        |							ТЧАналоги.Номенклатура
	        |						ИЗ
	        |							ТЧАналоги)
	        |					И НЕ Склад В (&СкладыИсключения)) КАК ТоварыНаСкладахОстатки
	        |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыКОтгрузке.Остатки(
	        |					,
	        |					Номенклатура В
	        |							(ВЫБРАТЬ
	        |								ТЧАналоги.Номенклатура
	        |							ИЗ
	        |								ТЧАналоги)
	        |						И НЕ Склад В (&СкладыИсключения)) КАК ТоварыКОтгрузкеОстатки
	        |			ПО ТоварыНаСкладахОстатки.Номенклатура = ТоварыКОтгрузкеОстатки.Номенклатура
	        |				И ТоварыНаСкладахОстатки.Склад = ТоварыКОтгрузкеОстатки.Склад
	        |				И ТоварыНаСкладахОстатки.Назначение = ТоварыКОтгрузкеОстатки.Назначение
	        |	
	        |	СГРУППИРОВАТЬ ПО
	        |		ТоварыНаСкладахОстатки.Склад,
	        |		ТоварыНаСкладахОстатки.Назначение,
	        |		ТоварыНаСкладахОстатки.Номенклатура
	        |	
	        |	ОБЪЕДИНИТЬ ВСЕ
	        |	
	        |	ВЫБРАТЬ
	        |		ТоварыНаСкладахОстатки.Склад,
	        |		СУММА(0),
	        |		СУММА(ЕСТЬNULL(ТоварыНаСкладахОстатки.ВНаличииОстаток, 0) - ЕСТЬNULL(ТоварыКОтгрузкеОстатки.КОтгрузкеОстаток, 0)),
	        |		СУММА(0),
	        |		ТоварыНаСкладахОстатки.Назначение,
	        |		2,
	        |		СУММА(ТоварыКОтгрузкеОстатки.КОформлениюОстаток),
	        |		ТоварыНаСкладахОстатки.Номенклатура
	        |	ИЗ
	        |		РегистрНакопления.ТоварыНаСкладах.Остатки(
	        |				,
	        |				Номенклатура В
	        |						(ВЫБРАТЬ
	        |							ТЧАналоги.Номенклатура
	        |						ИЗ
	        |							ТЧАналоги)
	        |					И НЕ Склад В (&СкладыИсключения)
	        |					И НЕ Назначение ЕСТЬ NULL
	        |					И НЕ Назначение = НЕОПРЕДЕЛЕНО
	        |					И НЕ Назначение = ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка)) КАК ТоварыНаСкладахОстатки
	        |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыКОтгрузке.Остатки(
	        |					,
	        |					Номенклатура В
	        |							(ВЫБРАТЬ
	        |								ТЧАналоги.Номенклатура
	        |							ИЗ
	        |								ТЧАналоги)
	        |						И НЕ Склад В (&СкладыИсключения)) КАК ТоварыКОтгрузкеОстатки
	        |			ПО ТоварыНаСкладахОстатки.Номенклатура = ТоварыКОтгрузкеОстатки.Номенклатура
	        |				И ТоварыНаСкладахОстатки.Склад = ТоварыКОтгрузкеОстатки.Склад
	        |				И ТоварыНаСкладахОстатки.Назначение = ТоварыКОтгрузкеОстатки.Назначение
	        |	
	        |	СГРУППИРОВАТЬ ПО
	        |		ТоварыНаСкладахОстатки.Склад,
	        |		ТоварыНаСкладахОстатки.Назначение,
	        |		ТоварыНаСкладахОстатки.Номенклатура
	        |	
	        |	ОБЪЕДИНИТЬ ВСЕ
	        |	
	        |	ВЫБРАТЬ
	        |		ТоварыНаСкладахОстатки.Склад,
	        |		СУММА(0),
	        |		СУММА(0),
	        |		СУММА(ЕСТЬNULL(ТоварыНаСкладахОстатки.ВНаличииОстаток, 0) - ЕСТЬNULL(ТоварыКОтгрузкеОстатки.КОтгрузкеОстаток, 0) - ЕСТЬNULL(ТоварыКОтгрузкеОстатки.ВРезервеОстаток, 0)),
	        |		ТоварыНаСкладахОстатки.Назначение,
	        |		3,
	        |		СУММА(ТоварыКОтгрузкеОстатки.КОформлениюОстаток),
	        |		ТоварыНаСкладахОстатки.Номенклатура
	        |	ИЗ
	        |		РегистрНакопления.ТоварыНаСкладах.Остатки(
	        |				,
	        |				Номенклатура В
	        |						(ВЫБРАТЬ
	        |							ТЧАналоги.Номенклатура
	        |						ИЗ
	        |							ТЧАналоги)
	        |					И НЕ Склад В (&СкладыИсключения)
	        |					И (Назначение ЕСТЬ NULL
	        |						ИЛИ Назначение = НЕОПРЕДЕЛЕНО
	        |						ИЛИ Назначение = ЗНАЧЕНИЕ(Справочник.Назначения.ПустаяСсылка))) КАК ТоварыНаСкладахОстатки
	        |			ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ТоварыКОтгрузке.Остатки(
	        |					,
	        |					Номенклатура В
	        |							(ВЫБРАТЬ
	        |								ТЧАналоги.Номенклатура
	        |							ИЗ
	        |								ТЧАналоги)
	        |						И НЕ Склад В (&СкладыИсключения)) КАК ТоварыКОтгрузкеОстатки
	        |			ПО ТоварыНаСкладахОстатки.Номенклатура = ТоварыКОтгрузкеОстатки.Номенклатура
	        |				И ТоварыНаСкладахОстатки.Склад = ТоварыКОтгрузкеОстатки.Склад
	        |	
	        |	СГРУППИРОВАТЬ ПО
	        |		ТоварыНаСкладахОстатки.Склад,
	        |		ТоварыНаСкладахОстатки.Назначение,
	        |		ТоварыНаСкладахОстатки.Номенклатура) КАК ВложенныйЗапрос
	        |
	        |СГРУППИРОВАТЬ ПО
	        |	ВложенныйЗапрос.Склад,
	        |	ВложенныйЗапрос.Назначение,
	        |	ВложенныйЗапрос.Номенклатура
	        |
	        |УПОРЯДОЧИТЬ ПО
	        |	Склад